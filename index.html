<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>My Website</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script runat="server">
    Platform.Load("core","1");

    var csp = ""
      + "default-src 'self' https://cdn.evergage.com https://cdn.c360a.salesforce.com; "
      // Añadimos 'unsafe-eval' SOLO como medida temporal
      + "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.evergage.com https://cdn.c360a.salesforce.com; "
      + "style-src  'self' 'unsafe-inline' https://cdn.evergage.com; "
      + "img-src    'self' data: https://cdn.evergage.com; "
      + "font-src   'self' data: https://cdn.evergage.com; "
      + "connect-src 'self' https://cdn.evergage.com https://cdn.c360a.salesforce.com; "
      + "frame-ancestors 'self';";

    Platform.Response.SetResponseHeader("Content-Security-Policy", csp);
    Platform.Response.SetResponseHeader("X-Frame-Options", "SAMEORIGIN");
    Platform.Response.SetResponseHeader("Strict-Transport-Security", "max-age=31536000; includeSubDomains; preload");
    Platform.Response.SetResponseHeader("Referrer-Policy", "strict-origin-when-cross-origin");
    Platform.Response.SetResponseHeader("X-Content-Type-Options", "nosniff");
    // Platform.Response.SetResponseHeader("X-XSS-Protection","1; mode=block"); // obsoleto
    </script>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: #f4f4f4;
        }

        nav {
            background-color: #2c3e50;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .logo {
            color: white;
            font-size: 1.5em;
            font-weight: bold;
        }

        .menu {
            display: flex;
            gap: 20px;
        }

        .menu a {
            white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .menu a:hover {
            color: #1abc9c;
        }

        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
        }

        .hamburger div {
            width: 25px;
            height: 3px;
            background-color: white;
            margin: 4px 0;
        }

        @media (max-width: 768px) {
            .menu {
                display: none;
                flex-direction: column;
                background-color: #2c3e50;
                position: absolute;
                top: 60px;
                right: 20px;
                width: 200px;
                padding: 10px;
                border-radius: 5px;
            }

            .menu.active {
                display: flex;
            }

            .hamburger {
                display: flex;
            }
        }
    </style>
  
  <script type="text/javascript" src="https://cdn.c360a.salesforce.com/beacon/c360a/ec6d0f23-508a-4c52-85c9-cab01bb37861/scripts/c360a.min.js"></script>
</head>
  
<body>
     <nav>
        <div class="logo">My Website</div>
        <div class="hamburger" onclick="toggleMenu()">
            <div></div>
            <div></div>
            <div></div>
        </div>
        <div class="menu" id="menu">
            <a href="https://cloud.zakelijk.vodafone.nl/SF_Personalization_Test/home" id="homeLink">Home</a>
            <a href="https://cloud.zakelijk.vodafone.nl/SF_Personalization_Test/products" id="productsLink">Products</a>
            <a href="https://cloud.zakelijk.vodafone.nl/SF_Personalization_Test/cart" id="cartLink">Shopping Cart <span class="cart-count">0</span></a>
        </div>
    </nav>

    <main style="padding: 20px;">
      <h1>Salesforce Personalization Test</h1>
      <p>Select an option from the menu to get started.</p>
      <button id="login" class="loginButton">
        Log in
      </button>
    </main>

      <!-- Cookie Consent Modal -->
    <div id="cookie-modal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.6); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div style="background-color: white; padding: 30px; border-radius: 10px; max-width: 400px; text-align: center;">
            <h2>Cookie Consent</h2>
            <p>We use cookies to personalize content and ads, to provide social media features and to analyze our traffic. Do you accept communications?</p>
            <div style="margin-top: 20px;">
                <button id="opt-in" style="padding: 10px 20px; margin-right: 10px; background-color: #2ecc71; color: white; border: none; border-radius: 5px;">Accept</button>
                <button id="opt-out" style="padding: 10px 20px; background-color: #e74c3c; color: white; border: none; border-radius: 5px;">Decline</button>
            </div>
        </div>
    </div>
<script>
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('active');
        }

        document.addEventListener('DOMContentLoaded', function () {
        const modal = document.getElementById('cookie-modal');
        const btnOptIn  = document.getElementById('opt-in');
        const btnOptOut = document.getElementById('opt-out');

        // Muestra el modal siempre al cargar (no persistimos la decisión)
        modal.style.display = 'flex';

        // Promise de consentimiento: se resuelve cuando el usuario hace clic
        const consentPromise  = new Promise((resolve) => {
            btnOptIn.addEventListener('click', () => {
                console.log('User accepted communications');
                console.log(consentPromise); 
                modal.style.display = 'none';
                resolve([
                    { provider: 'Cookie Banner', purpose: 'Tracking', status: SalesforceInteractions.ConsentStatus.OptIn }
                ]);
            }, { once: true });

            btnOptOut.addEventListener('click', () => {
                console.log('User declined communications');
                console.log(consentPromise); 
                modal.style.display = 'none';
                resolve([
                    { provider: 'Cookie Banner', purpose: 'Tracking', status: SalesforceInteractions.ConsentStatus.OptOut }
                ]);
            }, { once: true });
        });
         
/*
        SalesforceInteractions.init({
            
            cookieDomain: 'cloud.zakelijk.vodafone.nl', 
            consents: consentPromise
        }).then(() => {
            SalesforceInteractions.initSitemap({
                global: {},
                pageTypeDefault: {
                    name: 'All Pages',
                    isMatch: () => true
                }
            });
        });
*/         
          
        // (Opcional) Reinit para SPA si cambia la URL sin recargar página
        let href = window.location.href;
        setInterval(() => {
            if (href !== window.location.href) {
                href = window.location.href;
                if (window.SalesforceInteractions && SalesforceInteractions.reinit) {
                    SalesforceInteractions.reinit();
                }
            }
        }, 200);
    });
    </script>
  
  
</body>
</html>
